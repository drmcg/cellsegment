---

title: Model Inference Utilities
keywords: fastai
sidebar: home_sidebar

summary: "Functions that are used the run a model over the test set"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_inference_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bb_hw" class="doc_header"><code>bb_hw</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bb_hw</code>(<strong><code>a</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="draw_outline" class="doc_header"><code>draw_outline</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>draw_outline</code>(<strong><code>o</code></strong>, <strong><code>lw</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="draw_rect" class="doc_header"><code>draw_rect</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>draw_rect</code>(<strong><code>ax</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="draw_text" class="doc_header"><code>draw_text</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>draw_text</code>(<strong><code>ax</code></strong>, <strong><code>xy</code></strong>, <strong><code>txt</code></strong>, <strong><code>sz</code></strong>=<em><code>12</code></em>, <strong><code>color</code></strong>=<em><code>'white'</code></em>, <strong><code>valign</code></strong>=<em><code>'top'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_inferences" class="doc_header"><code>run_inferences</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_inferences</code>(<strong><code>learn</code></strong>:<code>Learner</code>, <strong><code>fnames</code></strong>:<code>list</code>, <strong><code>start</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>number_files</code></strong>=<em><code>20</code></em>)</p>
</blockquote>
<p>run inferences over a list of <code>fnames</code> using <code>learner</code></p>
<ul>
<li>return a list of predictions</li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_inferences" class="doc_header"><code>plot_inferences</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_inferences</code>(<strong><code>preds</code></strong>:<code>List</code>, <strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>src_path</code></strong>:<code>Path</code>=<em><code>PosixPath('.')</code></em>, <strong><code>start</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>rows</code></strong>:<code>int</code>=<em><code>4</code></em>, <strong><code>cols</code></strong>:<code>int</code>=<em><code>5</code></em>)</p>
</blockquote>
<p>Plot test images with auto markup labels</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_probs_df" class="doc_header"><code>create_probs_df</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_probs_df</code>(<strong><code>fnames</code></strong>:<code>List</code>)</p>
</blockquote>
<p>create a data frame of prob from a <code>fname</code> list</p>
<ul>
<li>param fnames:</li>
<li>return: <code>DataFrame</code></li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_cols_to_probs_df" class="doc_header"><code>add_cols_to_probs_df</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L108" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_cols_to_probs_df</code>(<strong><code>df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="probs_to_df" class="doc_header"><code>probs_to_df</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>probs_to_df</code>(<strong><code>preds</code></strong>:<code>List</code>, <strong><code>df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="__get_props" class="doc_header"><code>__get_props</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>__get_props</code>(<strong><code>raw_pred</code></strong>:<code>tensor</code>, <strong><code>layer</code></strong>:<code>int</code>, <strong><code>min_conf</code></strong>:<code>float</code>=<em><code>0.2</code></em>, <strong><code>min_area</code></strong>:<code>int</code>=<em><code>100</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_probs" class="doc_header"><code>calc_probs</code><a href="https://github.com/johnnewto/cellsegment/tree/master/cellsegment/inference_utils.py#L160" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_probs</code>(<strong><code>raw_pred</code></strong>:<code>tensor</code>)</p>
</blockquote>
<p>Calculate the probabilities from a raw prediction
by finding the average value of all the pixels within a region
This assumes that there is only one cell in the image
:param raw_pred:
:return:</p>

</div>

</div>

</div>
</div>

</div>
</div>
 

